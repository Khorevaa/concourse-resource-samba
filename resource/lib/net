#!/usr/bin/env bash

smb () {
	([ -n "${1}" ]) \
		&& connection=$1 \
		|| abort "missing connect"

	echo "/usr/bin/smbclient $connection --grepable --debuglevel=0 ${@:2}"
}

smb_get () {
	log "smb_get" $@

	([ -n "${1}" ]) \
		&& unc=$1 \
		|| abort "missing //server/share"
	([ -n "${2}" ]) \
		&& path="--directory=${2}" \
		|| path=""
	([ -n "${3}" ]) \
		&& target="${3}" \
		|| target=""
	([ -n "${4}" ]) \
		&& archive=$4 \
		|| archive=""
	([ -n "${5}" ]) \
		&& user="--user=${5} " \
		|| user=""
	([ -n "${6}" ]) \
		&& password="${6} " \
		|| password="'' -N "

	smb "$unc $password $user $path" -Tc $archive $target
}

smb_put () {
	log "smb_put" $@

	# connection string
	([ -n "${1}" ]) \
		&& connection=$1 \
		|| abort "missing //server/share"
	# path to upload into
	([ -n "${2}" ]) \
		&& path="--directory=${2}" \
	# archive to upload and unpack
	([ -n "${3}" ]) \
		&& archive=$3 \
		|| abort "missing archive to upload"

	# username and password
	([ -n "${4}" ]) \
		&& user="--user=${4} " \
		|| user=""
	([ -n "${5}" ]) \
		&& password="${5} " \
		|| password="'' -N "

	smb "$connection $password $user $path" -Tx $archive
}


